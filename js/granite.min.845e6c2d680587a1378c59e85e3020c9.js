(function(d,e,m){var f;e.Granite=e.Granite||{};e.Granite.$=e.Granite.$||d;e._g=e._g||{};e._g.$=e._g.$||d;f=Granite.HTTP;d.ajaxSetup({externalize:!0,encodePath:!0,hook:!0,beforeSend:function(g,b){"undefined"!=typeof G_IS_HOOKED&&G_IS_HOOKED(b.url)||(b.externalize&&(b.url=f.externalize(b.url)),b.encodePath&&(b.url=f.encodePathOfURI(b.url)));b.hook&&(g=f.getXhrHook(b.url,b.type,b.data))&&(b.url=g.url,g.params&&("GET"==b.type.toUpperCase()?b.url+="?"+d.param(g.params):b.data=d.param(g.params)))},statusCode:{403:function(d){"Authentication Failed"===
d.getResponseHeader("X-Reason")&&f.handleLoginRedirect()}}});d.ajaxSettings.traditional=!0})(jQuery,this);
(function(d,e){function m(){this._handler=[]}function f(a){var c="//"+document.location.host,b=document.location.protocol+c;return a==b||a.slice(0,b.length+1)==b+"/"||a==c||a.slice(0,c.length+1)==c+"/"||!/^(\/\/|http:|https:).*/.test(a)}function g(){k=new m;var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)try{h=JSON.parse(a.responseText).token,k.resolve(h)}catch(c){k.reject(a.responseText)}};a.open("GET",Granite.HTTP.externalize(p),!0);a.send();return k}function b(a){var c=
a.getAttribute("action");"GET"===a.method.toUpperCase()||c&&!f(c)||(c=a.querySelector('input[name\x3d":cq_csrf_token"]'),c||(c=document.createElement("input"),c.setAttribute("type","hidden"),c.setAttribute("name",":cq_csrf_token"),a.appendChild(c)),c.setAttribute("value",h))}function n(a){var c=function(a){a=a.target;"form"===a.nodeName.toLowerCase()&&h&&b(a)};a.addEventListener?a.addEventListener("submit",c,!0):a.attachEvent&&a.attachEvent("submit",c)}d.Granite=d.Granite||{};if(!d.Granite.csrf){d.Granite.csrf=
{initialised:!1,refreshToken:g};m.prototype={then:function(a,c){this._handler.push({resolve:a,reject:c})},resolve:function(){this._execute("resolve",arguments)},reject:function(){this._execute("reject",arguments)},_execute:function(a,c){if(null===this._handler)throw Error("Promise already completed.");for(var b=0,e=this._handler.length;b<e;b++)this._handler[b][a].apply(d,c);this.then=function(b,e){("resolve"===a?b:e).apply(d,c)};this._handler=null}};var p="/libs/granite/csrf/token.json",k,h;g();n(document);
var q=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(a,c){f(c)&&"get"!==a.toLowerCase()&&(this._csrf=!0);return q.apply(this,arguments)};var l=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(a){if(this._csrf)if(h)this.setRequestHeader("CSRF-Token",h),l.apply(this,arguments);else{var c=this,b=Array.prototype.slice.call(arguments);k.then(function(a){c.setRequestHeader("CSRF-Token",a);l.apply(c,b)},function(){d.console&&console.error("Unable to read CSRF meta information");
l.apply(c,b)})}else l.apply(this,arguments)};var r=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){b(this);return r.apply(this,arguments)};if(d.Node){var t=Node.prototype.appendChild;Node.prototype.appendChild=function(){var a=t.apply(this,arguments);if("IFRAME"===a.nodeName)try{a.contentWindow&&!a._csrf&&(a._csrf=!0,n(a.contentWindow.document))}catch(c){a.src&&a.src.length&&f(a.src)&&d.console&&console.error("Unable to attach CSRF token an iframe element on the same origin")}return a}}setInterval(function(){g()},
3E5)}})(this);